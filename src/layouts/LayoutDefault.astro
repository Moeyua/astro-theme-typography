---
import { getImage } from "astro:assets";
import { SEO, type SEOProps } from "astro-seo";
import { themeConfig } from "~/.config";
import Footer from "~/components/Footer.astro";
import Header from "~/components/Header.astro";
// import "~/styles/heti.min.css";
import "~/styles/index.css";

interface Props {
	title?: string;
	desc?: string;
	banner?: ImageMetadata;
}

const props = Astro.props;

const title = props.title ?? themeConfig.site.title;
const desc = props.desc ?? themeConfig.site.description;
const canonical = themeConfig.site.website;
const twitter = themeConfig.seo.twitter;
const rss = new URL("/atom.xml", Astro.site).toString();
const optimizedImage = await getOptimizedImageURL();

const seoLinks = [
	{ rel: "icon", href: "/favicon.svg", type: "image/svg+xml" },
	{
		rel: "alternate",
		type: "application/rss+xml",
		title: themeConfig.site.title,
		href: rss,
	},
];

const seoMeta = [
	{ name: "twitter:image:src", content: optimizedImage },
	{ name: "twitter:image:alt", content: desc },
	{ name: "twitter:creator", content: twitter },
	{ name: "twitter:site", content: twitter },
	{ name: "twitter:card", content: "summary_large_image" },
	{ name: "twitter:title", content: title },
	{ name: "twitter:description", content: desc },
];

const openGraph: SEOProps["openGraph"] = {
	basic: {
		title: title,
		type: "article",
		image: optimizedImage,
		url: canonical,
	},
};

async function getOptimizedImageURL() {
	const image =
		props.banner && (await getImage({ src: props.banner, format: "jpeg" }));
	return new URL(image?.src ?? "/placeholder.png", Astro.url).toString();
}
---
<html lang="en" class="animation-prepared">
  <head>
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <SEO
      charset="utf-8"
      title={title}
      description={desc}
      extend={{
        link: seoLinks,
        meta: seoMeta,
      }}
      openGraph={openGraph}
    />
  </head>
  <body>
    <div
      un-lg="flex flex-row-reverse justify-between gap-4 px-8 mx-auto max-w-6xl"
      class="container contain-layout m-a"
    >
      <div
        un-lg="sticky top-0 h-screen py-20 gap-8"
        un-lg:flex="~ col justify-between items-start gap-4"
        class="p-7.5 transition-swup-header"
      >
        <Header />
        <Footer class="max-lg:hidden" />
      </div>
      <main un-lg="py-20 min-w-xl" class="p-7.5 transition-swup-main">
        <slot />
      </main>
      <Footer class="lg:hidden p-7.5"/>
    </div>
  </body>
</html>

<script>
document.addEventListener('animationend', removeAnimation, false)
function removeAnimation() {
  document.documentElement.classList.remove("animation-prepared");
  document.removeEventListener('animationend', removeAnimation, false);
}
</script>

<style>
/* 页面首次加载动画 */
html.animation-prepared .transition-swup-header {
  animation: fade-in-down 1s linear 1;
  --at-apply: 'lg-animate-name-fade-in-left';
}

html.animation-prepared .transition-swup-main {
  animation: fade-in-down 1s linear 1;
}

@keyframes fade-in-down {
  0% {
    transform: translateY(-1rem);
    opacity: 0;
  }
  100% {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes fade-in-left {
  0% {
    opacity: 0;
    transform: translateX(1rem);
  }

  100% {
    opacity: 1;
    transform: translateX(0);
  }
}

/* 页面过渡动画 */
html.is-animating .transition-swup-main {
  opacity: 0;
  transform: translateY(-1rem);
}
html.is-leaving .transition-swup-main {
  opacity: 0;
  transform: translateY(1rem);
}
.transition-swup-main {
  ransition-property: opacity, transform;
  transition-duration: 0.5s;
  transition-timing-function: linear;
  transform: translateY(0);
  opacity: 1;
}
</style>
